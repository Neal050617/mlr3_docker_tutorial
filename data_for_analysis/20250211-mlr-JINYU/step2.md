# 机器学习模型构建与评估流程

## 第二步：特征选择与模型构建

### 数据准备阶段

- 加载第一步预处理后的数据（`step1.RData`）
- 将数据转换为分类任务，设置目标变量为`feature13`，正例为`1`
- 识别数据中的分类变量和连续变量，为后续预处理做准备

### 数据预处理流程

- 对连续变量进行直方图插补（histogram imputation）
- 对分类变量进行众数插补（mode imputation）
- 移除常量特征（没有变化的特征）
- 剔除临床特征（通过选择器实现）
- 将预处理后的数据保存为`step2_data14.xls`以便检查

### 数据集划分

- 将预处理后的数据集按9:1比例划分为训练集和测试集
- 使用训练集进行模型构建和调优
- 保留测试集用于最终模型验证

### 特征选择策略

- 采用Boruta算法进行特征选择
  - Boruta是一种基于随机森林的特征选择方法
  - 通过比较真实特征与随机生成的"影子特征"的重要性来识别相关特征
  - 设置最大运行次数为100，确保算法充分迭代

### 模型构建

同时构建四种不同类型的分类模型：

1. **弹性网络（Elastic Net）**
   - 结合L1和L2正则化的线性模型
   - 调优参数：lambda（正则化强度）、alpha（L1/L2混合比例）等

2. **XGBoost**
   - 基于梯度提升的集成树模型
   - 调优参数：学习率、树深度、迭代次数、特征采样比例等

3. **随机森林（Random Forest）**
   - 基于决策树的集成模型
   - 调优参数：树数量、最大深度、最小节点大小、特征采样数量等

4. **支持向量机（SVM）**
   - 非线性分类算法
   - 调优参数：正则化参数cost、核函数类型、多项式度数等

### 超参数调优设计

- 采用嵌套交叉验证方法：
  - 内层：5折交叉验证用于超参数优化
  - 外层：5折交叉验证用于模型性能评估
- 使用随机搜索策略在参数空间中高效探索
- 设置多种终止条件：
  - 性能停滞（连续10次迭代性能提升小于0.005）
  - 最大评估次数（100次）
  - 最大运行时间（1小时）
  - 达到目标性能（AUC达到0.85）

### 模型评估与比较

- 使用多种评估指标：
  - 主要指标：AUC（曲线下面积）
  - 辅助指标：准确率（Accuracy）、分类错误率（CE）
- 绘制ROC曲线评估模型性能
- 进行模型性能对比分析，选择最佳模型

### 特征重要性分析

- 对最佳模型提取特征重要性分数
- 可视化展示前20个最重要特征
- 保存筛选后的特征列表，为后续分析做准备

### 结果保存

- 保存基准测试结果（`benchmark_results.rds`）
- 保存最终模型及性能评估（`final_model.RData`）
- 保存筛选后的特征列表（`selected_features.txt`）

## 分析结果

通过综合评估各模型在训练集和测试集上的表现，可以选出最佳的分类模型及其优化参数组合。特征重要性分析帮助识别对预测目标最有影响的关键变量，为后续研究提供重要参考。
